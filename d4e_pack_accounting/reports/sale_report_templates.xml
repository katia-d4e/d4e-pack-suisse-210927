<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_saleorder_document" inherit_id="sale.report_saleorder_document">
        <xpath expr="//tbody[hasclass('sale_tbody')]/t[@t-foreach='doc.order_line']" position="before">
            <t t-set="order_line_ids" t-value="doc.order_line" />
        </xpath>
        <xpath expr="//tbody[hasclass('sale_tbody')]/t[@t-foreach='doc.order_line']" position="attributes">
            <attribute name="t-foreach">order_line_ids</attribute>
        </xpath>
        <xpath expr="//td[@name='td_amount_untaxed']/span" position="attributes">
            <attribute name="style">display: none !important;</attribute>
        </xpath>
        <xpath expr="//td[@name='td_amount_untaxed']" position="inside">
            <span t-field="doc.amount_untaxed_with_disc" />
        </xpath>
        <xpath expr="//td[@name='td_amount_untaxed_label']/parent::tr" position="after">
            <tr t-if="doc.discount_num != 0">
                <td><strong>Discount <span t-field="doc.discount_num"/>%</strong></td>
                <td class="text-right">
                    <span t-field="doc.amount_discount"/>
                </td>
            </tr>
        </xpath>
        <xpath expr="//tbody[hasclass('sale_tbody')]/t/tr" position="inside">
            <t t-if="line.display_type == 'line_title'">
                <td class="text-left" name="td_title_line" colspan="99">
                    <strong t-field="line.name" />
                </td>
            </t>
            <t t-if="line.display_type == 'line_sub_total'">
                <td class="text-right" name="td_sub_total_line" colspan="99">
                    <strong class="mr16">
                        <t t-esc="line.name" />
                    </strong>
                    <span t-field="line.section_total" />
                </td>
            </t>
            <t t-if="line.totals_below_sections and line.display_type == 'line_section_sub_total'">
                <td class="is-subtotal text-right" colspan="99">
                    <t t-set="section_sub_total_line" t-value="current_section and doc.order_line.filtered(lambda line_id: line_id.section_number == current_section.section_number and line_id.display_type == 'line_section_sub_total') or None" />
                    <strong class="mr16">
                        <t t-if="section_sub_total_line" t-esc="section_sub_total_line.name" />
                        <t t-if="not section_sub_total_line">
                            Sub-total
                        </t>
                    </strong>
                    <span t-field="line.section_total" />
                </td>
            </t>
        </xpath>
        <xpath expr="//tr[hasclass('is-subtotal')]" position="attributes">
            <attribute name="t-if">not line.totals_below_sections</attribute>
        </xpath>
    </template>
</odoo>
