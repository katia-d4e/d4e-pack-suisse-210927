<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.ui.menu" id="account.menu_action_account_moves_all">
        <field eval="[(3, ref('base.group_no_one'))]" name="groups_id"/>
    </record>

    <function name="write" model="ir.model.data">
        <function name="search" model="ir.model.data">
            <value eval="[('module', '=', 'account_reports'), ('name', 'ilike', 'account_financial_html_report_menu_')]"/>
        </function>
        <value eval="{'noupdate': False}"/>
    </function>

    <record model="ir.ui.menu" id="account_reports.account_financial_html_report_menu_1">
        <field eval="False" name="active"/>
    </record>

    <record model="ir.ui.menu" id="account_reports.account_financial_html_report_menu_2">
        <field eval="False" name="active"/>
    </record>

    <function name="write" model="ir.model.data">
        <function name="search" model="ir.model.data">
            <value eval="[('module', '=', 'account_reports'), ('name', 'ilike', 'account_financial_html_report_menu_')]"/>
        </function>
        <value eval="{'noupdate': True}"/>
    </function>

    <record id="action_print_qr_on_invoice" model="ir.actions.server">
        <field name="name">Print invoice with QR</field>
        <field name="model_id" ref="account.model_account_move" />
        <field name="binding_model_id" ref="account.model_account_move" />
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
            if records and records.filtered(lambda r: r.state == 'posted' and r.move_type == 'out_invoice'):
                action = env.ref('d4e_pack_accounting.report_account_invoices_with_qr').report_action(records.filtered(lambda r: r.state == 'posted' and r.move_type == 'out_invoice'))
        </field>
    </record>

    <record id="action_print_isr_on_invoice" model="ir.actions.server">
        <field name="name">Print invoice with ISR</field>
        <field name="model_id" ref="account.model_account_move" />
        <field name="binding_model_id" ref="account.model_account_move" />
        <field name="state">code</field>
        <field name="code">
            if records:
                action = env.ref('d4e_pack_accounting.report_account_invoices_with_isr').report_action(records)
        </field>
    </record>

    <record id="action_print_qr_on_invoice_menu" model="ir.actions.server.menu">
        <field name="action_id" ref="d4e_pack_accounting.action_print_qr_on_invoice" />
        <field name="condition">model is 'account.move' and record.state != 'draft' and record.move_type is 'out_invoice'</field>
    </record>

    <record id="view_move_form" model="ir.ui.view">
        <field name="name">account.move.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='currency_id']" position="after">
                <field name="payment_mode" readonly="True"/>
            </xpath>
            <xpath expr="//field[@name='payment_reference']" position="after">
                <field name="is_correct_bvr" invisible="1"/>
            </xpath>
            <xpath expr="//group[@id='header_right_group']" position="after">
                <group string="Payments"
                       name="payments_info_group"
                       attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}">
                    <field name="payment_reference"
                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                    <field name="is_correct_bvr" invisible="1"/>
                    <span attrs="{'invisible': [('is_correct_bvr', '=', True)]}">Not a reference</span>
                    <span attrs="{'invisible': [('is_correct_bvr', '=', False)]}" style="color:green">Correct BVR reference</span>
                    <field name="partner_bank_id"
                           domain="[('partner_id', '=', bank_partner_id)]"
                           attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                </group>
            </xpath>
            <xpath expr="//group[@id='header_right_group']" position="inside">
                <field name="bank_details" invisible="1"/>
                <strong>
                    <span attrs="{'invisible': ['|',('bank_details', '=', True),('move_type','!=','in_invoice')]}" style="color: red ">Bank details seem :false</span>
                </strong>
                <strong>
                    <span attrs="{'invisible': ['|',('bank_details', '=', False),('move_type','!=','in_invoice')]}" style="color:green">Bank details seem :good</span>
                </strong>
            </xpath>
            <xpath expr="//div[@name='journal_div']" position="after">
                <field name="discount_num"
                       attrs="{'invisible': [('move_type', '!=', 'out_invoice')], 'readonly': [('state', '!=', 'draft')]}" />
                <button name="reorder_lines_action" string="Reorder lines"
                        type="object" class="btn-primary"
                        attrs="{'invisible': ['|', ('move_type', '!=', 'out_invoice'), ('discount_num', '=', 0)]}" />
            </xpath>
            <xpath expr="//field[@name='amount_untaxed']" position="after">
                <field name="amount_discount"
                       attrs="{'invisible': ['|', ('discount_num', '=', 0), ('move_type', '!=', 'out_invoice')]}" />
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='product_id']" position="after">
                <field name="is_discount_line" invisible="1" />
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='account_id']" position="after">
                <field name="is_discount_line" invisible="1" />
            </xpath>
            <xpath expr="//group[@id='header_left_group']" position="replace">
                <group id="header_left_group">
                    <div class="o_td_label">
                        <label for="partner_id" string="Customer" style="font-weight:bold;"
                               attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'out_receipt'))]}"/>
                        <label for="partner_id" string="Vendor" style="font-weight:bold;"
                               attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))]}"/>
                    </div>
                    <field name="partner_id" widget="res_partner_many2one" nolabel="1"
                           context="{
                                            'res_partner_search_mode': (context.get('default_move_type', 'entry') in ('out_invoice', 'out_refund', 'out_receipt') and 'customer') or (context.get('default_move_type', 'entry') in ('in_invoice', 'in_refund', 'in_receipt') and 'supplier') or False,
                                            'show_address': 1, 'default_is_company': True, 'show_vat': True}"
                           options='{"always_reload": True, "no_quick_create": True}'
                           attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                    <field name="internal_reference"/>
                    <label for="ref" string="Bill Reference"
                           attrs="{'invisible':[('move_type', 'not in', ('in_invoice', 'in_receipt', 'in_refund'))]}"/>
                    <field name="ref" nolabel="1"
                           attrs="{'invisible':[('move_type', 'not in', ('in_invoice', 'in_receipt', 'in_refund'))]}"/>
                    <field name="ref"
                           attrs="{'invisible':[('move_type', 'in', ('in_invoice', 'in_receipt', 'in_refund', 'out_invoice', 'out_refund','entry'))]}"/>
                    <field name="payment_reference"
                           attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))], 'readonly': [('state', '!=', 'draft')]}"/>
                    <field name="partner_bank_id"
                           context="{'default_partner_id': bank_partner_id}"
                           domain="[('partner_id', '=', bank_partner_id)]"
                           attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))], 'readonly': [('state', '!=', 'draft')]}"/>
                    <label name="invoice_vendor_bill_id_label" for="invoice_vendor_bill_id" string="Auto-Complete"
                           class="oe_edit_only"
                           attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('move_type', '!=', 'in_invoice')]}"/>
                    <field name="invoice_vendor_bill_id" nolabel="1" class="oe_edit_only"
                           attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('move_type', '!=', 'in_invoice')]}"
                           domain="[('company_id', '=', company_id), ('partner_id','child_of', [partner_id]), ('move_type','=','in_invoice')]"
                           placeholder="Select an old vendor bill"
                           options="{'no_create': True}" context="{'show_total_amount': True}"/>
                </group>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="new_section_number" invisible="1" />
                <field name="sections_sum_total" invisible="1" />
            </xpath>
            <xpath expr="//control" position="inside">
                <create name="add_title_control" string="Add a Title" context="{'default_display_type': 'line_title'}" />
                <create name="add_sub_total_control" string="Add a Sub-total" context="{'default_display_type': 'line_sub_total'}" />
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='price_total']" position="before">
                <field name="section_total" invisible="1" />
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='price_total']" position="after">
                <field name="section_number" invisible="1" />
                <field name="tax_selection" invisible="1" />
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']/form//field[@name='name']" position="before">
                <label for="name" string="Section Sub-total name" attrs="{'invisible': [('display_type', '!=', 'line_section_sub_total')]}"/>
                <label for="name" string="Sub-total name" attrs="{'invisible': [('display_type', '!=', 'line_sub_total')]}"/>
                <label for="name" string="Title name" attrs="{'invisible': [('display_type', '!=', 'line_title')]}"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']" position="attributes">
                <attribute name="widget">pack_aml_section_and_note_one2many</attribute>
            </xpath>
            <xpath expr="//field[@name='invoice_date']" position="after">
                <field name="print_date" readonly="1"/>
                <field name="printed" readonly="1"/>
                <field name="sent" readonly="1"/>
            </xpath>
            <xpath expr="//header" position="inside">
                <button name="%(action_print_qr_on_invoice)d" class="oe_highlight" string="Print invoice with QR"
                        attrs="{'invisible': ['|', ('state', '!=', 'posted'), ('move_type', '!=', 'out_invoice')]}"
                        type="action" />
            </xpath>
            <xpath expr="//group[@id='header_right_group']" position="after">
                <group></group>
                <group>
                    <field name="is_stop_total"
                           attrs="{'invisible': [('move_type', '!=', 'out_invoice')], 'readonly': [('state', '!=', 'draft')]}" />
                    <field name="stop" widget="radio" options="{'horizontal': true}"
                           attrs="{'invisible': [('is_stop_total', '=', False)], 'readonly': [('state', '!=', 'draft')]}" />
                    <field name="stop_at"
                           attrs="{'invisible': [('is_stop_total', '=', False)], 'readonly': [('state', '!=', 'draft')], 'required': [('is_stop_total', '=', True), ('state', '=', 'draft')]}" />
                    <button name="reorder_lines_action" string="Reorder lines"
                            type="object" class="btn-primary"
                            attrs="{'invisible': ['|', ('is_stop_total', '=', False), ('discount_num', '!=', 0)]}" />
                </group>
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='product_id']" position="after">
                <field name="is_stop_line" invisible="True" />
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='product_id']" position="after">
                <field name="is_stop_line" invisible="True" />
            </xpath>
            <xpath expr="//field[@name='amount_untaxed']" position="after">
                <field name="amount_discount"
                       attrs="{'invisible': ['|', '|', ('move_type', '!=', 'out_invoice'), ('discount_num', '!=', 0), ('is_stop_total', '=', False)]}"
                       widget='monetary'
                       options="{'currency_field': 'currency_id'}" />
            </xpath>
        </field>
    </record>

    <record id="account.action_account_moves_all" model="ir.actions.act_window">
        <field name="domain">[('is_discount_section', '=', False), ('is_discount_line', '=', False), ('is_stop_line', '=', False), ('display_type', 'not in', ('line_section', 'line_note')), ('move_id.state', '!=', 'cancel')]</field>
    </record>

    <record id="account_invoice_view_tree" model="ir.ui.view">
        <field name="name">account.move.tree.inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='ref']" position="after">
                <field name="internal_reference"/>
            </xpath>
            <xpath expr="//field[@name='move_type']" position="after">
                <field name="payment_mode" optional="hide"/>
            </xpath>
        </field>
    </record>

    <record id="view_account_invoice_filter" model="ir.ui.view">
        <field name="name">account.invoice.select.account_check_printing</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="ref"/>
                <field name="internal_reference"/>
            </field>
        </field>
    </record>

    <menuitem id="menu_action_res_partner_bank_form"
              action="base.action_res_partner_bank_account_form"
              parent="account.account_banks_menu"
              sequence="2"/>

    <menuitem id="menu_config_banks_list"
              name="Banks List"
              action="base.action_res_bank_form"
              parent="account.account_banks_menu"
              sequence="4"/>

    <record id="escompte_inherit_view_payment_term_form" model="ir.ui.view">
        <field name="name">account.payment.term.form</field>
        <field name="model">account.payment.term</field>
        <field name="inherit_id" ref="account.view_payment_term_form" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='note']" position="after">
                <separator string="Escompte"/>
                <group>
                    <field name="is_escompte"/>
                    <field name="escompte_account_id" attrs="{'required': [('is_escompte', '=', True)], 'invisible': [('is_escompte', '=', False)]}"/>
                    <field name="escompte_label" attrs="{'required': [('is_escompte', '=', True)], 'invisible': [('is_escompte', '=', False)]}"/>
                </group>
            </xpath>
        </field>
    </record>

    <record id="action_move_print" model="ir.actions.server">
        <field name="name">Print Invoice</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="state">code</field>
        <field name="code">
            if records:
                action = env.ref('account.account_invoices').report_action(records)
        </field>
    </record>
</odoo>
